let t=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&"constructor"!==i&&void 0!==e[i]&&(t[i]=e[i])},e=(e,i,h,r)=>(i&&t(e,i),h&&t(e,h),r&&t(e,r),e),i=(t,e,i,h="height")=>"center"===i?(t[h]+e[h])/2:t.height,h={getId:t=>t.id||t.name,getPreH:t=>t.preH||0,getPreV:t=>t.preV||0,getHGap:t=>t.hgap||18,getVGap:t=>t.vgap||18,getChildren:t=>t.children,getHeight:t=>t.height||36,getWidth(t){let e=t.label||" ";return t.width||18*e.split("").length}};function r(t,e){if(this.vgap=this.hgap=0,t instanceof r)return t;this.data=t;let i=e.getHGap(t),h=e.getVGap(t);return this.id=e.getId(t),this.preH=e.getPreH(t),this.preV=e.getPreV(t),this.width=e.getWidth(t),this.height=e.getHeight(t),this.width+=this.preH,this.height+=this.preV,this.x=this.y=0,this.depth=0,this.children||(this.children=[]),this.addGap(i,h),this}e(r.prototype,{isRoot(){return 0===this.depth},isLeaf(){return 0===this.children.length},addGap(t,e){this.hgap+=t,this.vgap+=e,this.width+=2*t,this.height+=2*e},eachNode(t){let e=[this],i=null;for(;i=e.shift();)t(i),e=i.children.concat(e)},DFTraverse(t){this.eachNode(t)},BFTraverse(t){let e=[this],i=null;for(;i=e.shift();)t(i),e=e.concat(i.children)},getBoundingBox(){let t={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode(e=>{t.left=Math.min(t.left,e.x),t.top=Math.min(t.top,e.y),t.width=Math.max(t.width,e.x+e.width),t.height=Math.max(t.height,e.y+e.height)}),t},translate(t=0,e=0){this.eachNode(i=>{i.x+=t,i.y+=e,i.x+=i.preH,i.y+=i.preV})},right2left(){let t=this.getBoundingBox();this.eachNode(e=>{e.x=e.x-(e.x-t.left)*2-e.width}),this.translate(t.width,0)},bottom2top(){let t=this.getBoundingBox();this.eachNode(e=>{e.y=e.y-(e.y-t.top)*2-e.height}),this.translate(0,t.height)}});let l=(t,i={},l)=>{let n=new r(t,i=e(h,i)),o=[n],s=null;if(!l&&!t.collapsed){for(;s=o.shift();)if(!s.data.collapsed){let t=i.getChildren(s.data),e=t?t.length:0;if(s.children=Array(e),t&&e)for(let h=0;h<e;h++){let e=new r(t[h],i);s.children[h]=e,o.push(e),e.parent=s,e.depth=s.depth+1}}}return n};class n{constructor(t,e={}){this.rootNode=null,this.options={},this.options=e,this.rootNode=l(t,e)}execute(){throw Error("please override this method")}}let o=(t,e)=>{let i=l(t.data,e,!0),h=l(t.data,e,!0),r=t.children.length,n=Math.round(r/2),o=e.getSide||((t,e)=>e<n?"right":"left");for(let e=0;e<r;e++){let r=t.children[e];"right"===o(r,e)?h.children.push(r):i.children.push(r)}return i.eachNode(t=>{t.isRoot()||(t.side="left")}),h.eachNode(t=>{t.isRoot()||(t.side="right")}),{left:i,right:h}},s=["LR","RL","TB","BT","H","V"],c=["LR","RL","H"],d=s[0],a=t=>c.indexOf(t)>-1,g=(t,e,i)=>{let h=e.direction||d;if(e.isHorizontal=a(h),h&&-1===s.indexOf(h))throw TypeError(`Invalid direction: ${h}`);if(h===s[0])i(t,e);else if(h===s[1])i(t,e),t.right2left();else if(h===s[2])i(t,e);else if(h===s[3])i(t,e),t.bottom2top();else if(h===s[4]||h===s[5]){let{left:h,right:r}=o(t,e);i(h,e),i(r,e),e.isHorizontal?h.right2left():h.bottom2top(),r.translate(h.x-r.x,h.y-r.y),t.x=h.x,t.y=r.y;let l=t.getBoundingBox();e.isHorizontal?l.top<0&&t.translate(0,-l.top):l.left<0&&t.translate(-l.left,0)}let r=e.fixedRoot;return void 0===r&&(r=!0),r&&t.translate(-(t.x+t.width/2+t.hgap),-(t.y+t.height/2+t.vgap)),t};function f(t,e,i,h=[]){this.x=0,this.y=i||0,this.w=t||0,this.h=e||0,this.c=h||[],this.cs=h.length,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}f.fromNode=(t,e)=>{if(!t)return null;let i=[];return(t.children.forEach(t=>{i.push(f.fromNode(t,e))}),e)?new f(t.height,t.width,t.x,i):new f(t.width,t.height,t.y,i)};let u=(t,e={})=>{let i=e.isHorizontal,h=e.forceCompact;function r(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function l(t){return t.y+t.h}function n(t,e,i){for(;null!==i&&t>=i.low;)i=i.nxt;return{low:t,index:e,nxt:i}}!function t(e,i,h=0){i?(e.x=h,h+=e.width):(e.y=h,h+=e.height),e.children.forEach(e=>{t(e,i,h)})}(t,i);let o=f.fromNode(t,i);!function t(e){var i;if(0===e.cs)return void r(e);t(e.c[0]);let o=n(l(e.c[0].el),0,null);for(let i=1;i<e.cs;++i){t(e.c[i]);let r=l(e.c[i].er);(function(t,e,i,h){let r=t.c[e-1],n=r.mod,o=t.c[e],s=o.mod;for(;null!==r&&null!==o;){var c,d,a,g,f,u;l(r)>i.low&&(i=i.nxt);let p=n+r.prelim+r.w-(s+o.prelim);(h||p>0)&&(s+=p,c=t,d=e,a=i.index,g=p,c.c[d].mod+=g,c.c[d].msel+=g,c.c[d].mser+=g,function(t,e,i,h){if(i!==e-1){let r=e-i;t.c[i+1].shift+=h/r,t.c[e].shift-=h/r,t.c[e].change-=h-h/r}}(c,d,a,g));let y=l(r),x=l(o);y<=x&&null!==(r=0===(f=r).cs?f.tr:f.c[f.cs-1])&&(n+=r.mod),y>=x&&null!==(o=0===(u=o).cs?u.tl:u.c[0])&&(s+=o.mod)}!r&&o?function(t,e,i,h){let r=t.c[0].el;r.tl=i;let l=h-i.mod-t.c[0].msel;r.mod+=l,r.prelim-=l,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,o,s):r&&!o&&function(t,e,i,h){let r=t.c[e].er;r.tr=i;let l=h-i.mod-t.c[e].mser;r.mod+=l,r.prelim-=l,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,r,n)})(e,i,o,h),o=n(r,i,o)}(i=e).prelim=(i.c[0].prelim+i.c[0].mod+i.c[i.cs-1].mod+i.c[i.cs-1].prelim+i.c[i.cs-1].w)/2-i.w/2,r(e)}(o),function t(e,i){i+=e.mod,e.x=e.prelim+i,function(t){let e=0,i=0;for(let h=0;h<t.cs;h++)e+=t.c[h].shift,i+=e+t.c[h].change,t.c[h].mod+=i}(e);for(let h=0;h<e.cs;h++)t(e.c[h],i)}(o,0),function t(e,i,h){h?i.y=e.x:i.x=e.x,e.c.forEach((e,r)=>{t(e,i.children[r],h)})}(o,t,i);let s=function t(e,i){let h=i?e.y:e.x;return e.children.forEach(e=>{h=Math.min(t(e,i),h)}),h}(t,i);return!function t(e,i,h){h?e.y+=i:e.x+=i,e.children.forEach(e=>{t(e,i,h)})}(t,-s,i),t};class p extends n{execute(){return g(this.rootNode,this.options,u)}}let y=(t,i)=>new p(t,e({},{},i)).execute();function x(t=0,e=[]){this.x=this.y=0,this.leftChild=this.rightChild=null,this.height=0,this.children=e}let m={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10},w=(t,i={})=>{i=e({},m,i);let h=0,r=null,l=function t(e){if(!e)return null;e.width=0,e.depth&&e.depth>h&&(h=e.depth);let i=e.children,r=i.length,l=new x(e.height,[]);return i.forEach((e,i)=>{let h=t(e);l.children.push(h),0===i&&(l.leftChild=h),i===r-1&&(l.rightChild=h)}),l.originNode=e,l.isLeaf=e.isLeaf(),l}(t);return!function t(e){if(e.isLeaf||0===e.children.length)e.drawingDepth=h;else{let i=e.children.map(e=>t(e));e.drawingDepth=Math.min.apply(null,i)-1}return e.drawingDepth}(l),!function t(e){e.x=e.drawingDepth*i.rankSep,e.isLeaf?(e.y=0,r&&(e.y=r.y+r.height+i.nodeSep,e.originNode.parent!==r.originNode.parent&&(e.y+=i.subTreeSep)),r=e):(e.children.forEach(e=>{t(e)}),e.y=(e.leftChild.y+e.rightChild.y)/2)}(l),!function t(e,i,h){h?(i.x=e.x,i.y=e.y):(i.x=e.y,i.y=e.x),e.children.forEach((e,r)=>{t(e,i.children[r],h)})}(l,t,i.isHorizontal),t};class H extends n{execute(){return g(this.rootNode,this.options,w)}}let N=(t,i)=>new H(t,e({},{},i)).execute(),B=(t,e,h,r,l,n)=>{let o="function"==typeof h?h(t):h*t.depth;if(!r)try{if(t.id===t.parent.children[0].id||t.id===n?.children?.[0]?.id){t.x+=o,t.y=e?e.y:0;return}}catch(t){}if(t.x+=o,e){if(t.y=e.y+i(e,t,l),e.parent&&t.parent.id!==e.parent.id){let h=e.parent,r=h.y+i(h,t,l);t.y=r>t.y?r:t.y}}else t.y=0},E=(t,e,i,h)=>{let r=null;t.eachNode(l=>{B(l,r,e,i,h,t),r=l})},v=["LR","RL","H"],S=v[0];class T extends n{execute(){let t=this.options,e=this.rootNode;t.isHorizontal=!0;let{indent:i=20,dropCap:h=!0,direction:r=S,align:l}=t;if(r&&-1===v.indexOf(r))throw TypeError(`Invalid direction: ${r}`);if(r===v[0])E(e,i,h,l);else if(r===v[1])E(e,i,h,l),e.right2left();else if(r===v[2]){let{left:r,right:n}=o(e,t);E(r,i,h,l),r.right2left(),E(n,i,h,l);let s=r.getBoundingBox();n.translate(s.width,0),e.x=n.x-e.width/2}return e}}let b=(t,i)=>new T(t,e({},{},i)).execute(),L={getSubTreeSep:()=>0},M=(t,i={})=>{i=e({},L,i),t.parent={x:0,y:0,width:0,height:0},t.BFTraverse(t=>{t.x=t.parent.x+t.parent.width}),t.parent=null,function t(e,i){let h=0;return e.children.length?e.children.forEach(e=>{h+=t(e,i)}):h=e.height,e._subTreeSep=i.getSubTreeSep(e.data),e.totalHeight=Math.max(e.height,h)+2*e._subTreeSep,e.totalHeight}(t,i),t.startY=0,t.y=t.totalHeight/2-t.height/2,t.eachNode(t=>{let e=t.children,i=e.length;if(i){let h=e[0];if(h.startY=t.startY+t._subTreeSep,1===i)h.y=t.y+t.height/2-h.height/2;else{h.y=h.startY+h.totalHeight/2-h.height/2;for(let t=1;t<i;t++){let i=e[t];i.startY=e[t-1].startY+e[t-1].totalHeight,i.y=i.startY+i.totalHeight/2-i.height/2}}}}),function t(e){let i=e.children,h=i.length;if(h){i.forEach(e=>{t(e)});let r=i[0],l=i[h-1],n=l.y-r.y+l.height,o=0;if(i.forEach(t=>{o+=t.totalHeight}),n>e.height)e.y=r.y+n/2-e.height/2;else if(1!==i.length||e.height>o){let t=e.y+(e.height-n)/2-r.y;i.forEach(e=>{e.translate(0,t)})}else e.y=(r.y+r.height/2+l.y+l.height/2)/2-e.height/2}}(t)};class C extends n{execute(){return g(this.rootNode,this.options,M)}}let V=(t,i)=>new C(t,e({},{},i)).execute();export{y as layoutByCompactBox,N as layoutByDendrogram,b as layoutByIndented,V as layoutByMindmap};