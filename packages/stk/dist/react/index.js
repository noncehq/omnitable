import*as e from"fast-equals";import*as t from"react";import*as r from"ahooks";import*as u from"react-dom";import*as n from"scheduler";let o=r=>(0,t.memo)(r,(t,r)=>(0,e.deepEqual)(t,r));class s{constructor(e){this.el=e}by(e){return this.el=e.call(this,this.el),this}get(){return this.el}}let l=r=>(u,n)=>{let o=(0,t.useRef)(null),s=(0,t.useRef)(0);void 0!==n&&(0,e.deepEqual)(n,o.current)||(o.current=n,s.current+=1),r(u,[s.current])},c=Symbol(),i=Symbol(),a=n.unstable_runWithPriority?e=>(0,n.unstable_runWithPriority)(n.unstable_NormalPriority,e):e=>e();function p(e){var n;let s=(0,t.createContext)({[c]:{v:{current:e},n:{current:-1},l:new Set,u:e=>e()}});return s[i]=s.Provider,n=s.Provider,s.Provider=o(({value:e,children:o})=>{let s=(0,t.useRef)(e),l=(0,t.useRef)(0),[i,p]=(0,t.useState)(null);i&&(i(e),p(null));let f=(0,t.useRef)(null);if(!f.current){let e=new Set;f.current={[c]:{v:s,n:l,l:e,u:(t,r)=>{(0,u.unstable_batchedUpdates)(()=>{l.current+=1;let u={n:l.current};r?.suspense&&(u.n*=-1,u.p=new Promise(e=>{p(()=>t=>{u.v=t,delete u.p,e(t)})})),e.forEach(e=>e(u)),t()})}}}}return(0,r.useIsomorphicLayoutEffect)(()=>{s.current=e,l.current+=1,a(()=>{f.current[c].l.forEach(t=>{t({n:l.current,v:e})})})},[e]),(0,t.createElement)(n,{value:f.current},o)}),delete s.Consumer,s}function f(u,n){let o=(0,t.useContext)(u)[c];if("object"==typeof process&&"production"!==process.env.NODE_ENV&&!o)throw Error("useContextSelector requires special context");let{v:{current:s},n:{current:l},l:i}=o,a=n(s),[p,f]=(0,t.useReducer)((t,r)=>{if(!r)return[s,a];if("p"in r)throw r.p;if(r.n===l)return(0,e.deepEqual)(t[1],a)?t:[s,a];try{if("v"in r){if((0,e.deepEqual)(t[0],r.v))return t;let u=n(r.v);if((0,e.deepEqual)(t[1],u))return t;return[r.v,u]}}catch(e){}return[...t]},[s,a]);return(0,e.deepEqual)(p[1],a)||f(),(0,r.useIsomorphicLayoutEffect)(()=>(i.add(f),()=>{i.delete(f)}),[i]),p[1]}function d(e){return f(e,e=>e)}function m(e){let r=(0,t.useContext)(e)[c];if("object"==typeof process&&"production"!==process.env.NODE_ENV&&!r)throw Error("useContextUpdate requires special context");let{u:u}=r;return u}let E=({context:e,value:r,children:u})=>{let{[i]:n}=e;if("object"==typeof process&&"production"!==process.env.NODE_ENV&&!n)throw Error("BridgeProvider requires special context");return(0,t.createElement)(n,{value:r},u)},h=e=>{let r=(0,t.useContext)(e);if("object"==typeof process&&"production"!==process.env.NODE_ENV&&!r[c])throw Error("useBridgeValue requires special context");return r},v=(r,u)=>{let n=(0,t.useRef)(null);return n.current&&(0,e.deepEqual)(u,n.current.key)||(n.current={key:u,value:r()}),n.current.value},b=(e,u=300)=>{let n=(0,t.useRef)(0),o=(0,t.useRef)(null);return(0,r.useMemoizedFn)((...t)=>{n.current+=1,clearTimeout(o.current),o.current=setTimeout(()=>{n.current=0},u),2===n.current&&(e(...t),n.current=0)})},x=()=>{let[e,u]=(0,t.useState)(!1),[n,o]=(0,t.useState)(),s=(0,t.useRef)(null);return(0,r.useEventListener)("mouseup",()=>{let e=window.getSelection();if(!e||!e.toString().length)return;let t=e.getRangeAt(0),r=t.commonAncestorContainer,n=!1,s=r;for(;s;){if(s.hasAttribute("contenteditable")&&s.getAttribute("contenteditable")){n=!0;break}if(s.parentNode)s=s.parentNode;else break}n&&(u(!0),o(t.getBoundingClientRect()))},{target:s}),{selection_container:s,markup_visible:e,markup_rect:n,closeMarkup:(0,r.useMemoizedFn)(()=>u(!1))}},q=l(r.useUpdateEffect);var C=e.deepEqual;export{E as BridgeProvider,p as createContext,l as createDeepCompareEffect,s as handle,o as memo,h as useBridgeValue,d as useContext,f as useContextSelector,m as useContextUpdate,v as useDeepMemo,q as useDeepUpdateEffect,b as useDoubleClick,x as useSelection,C as deepEqual};