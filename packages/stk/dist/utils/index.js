import*as e from"classix";import*as t from"rfdc";import*as n from"fast-equals";import*as i from"react";let r={cx:e.default,memo:e=>(0,i.memo)(e,(e,t)=>(0,n.deepEqual)(e,t)),copy:(0,t.default)({proto:!0}),Handle:class{constructor(e){this.el=e}by(e){return this.el=e.call(this,this.el),this}get(){return this.el}}};class l{constructor(e,t,n){this.cloneHeader=null,this.lastElement=null,this.lastElementRefresh=null;let i=e.querySelector("thead");if(this.tableContainer=e,this.cloneContainer=t,this.top=n||{max:0},!i||!this.tableContainer.parentNode)throw Error("Header or parent node of sticky header table container not found!");this.tableContainerParent=this.tableContainer.parentNode,this.cloneContainerParent=this.cloneContainer.parentNode,this.header=i,this.scrollParents=this.getScrollParents(this.tableContainer),this.setup()}getScrollParents(e){let t=[],n=e.parentNode;for(;n;)n.scrollHeight>n.clientHeight&&n!==window&&t.push(n),n=n.parentNode;return t}setup(){this.setupSticky(),this.setupSizeMirroring(),this.setupClickEventMirroring(),this.setupHorizontalScrollMirroring()}destroy(){this.scrollListener&&(window.removeEventListener("scroll",this.scrollListener),this.scrollParents.forEach(e=>{e.removeEventListener("scroll",this.scrollListener)})),this.currentFrameRequest&&window.cancelAnimationFrame(this.currentFrameRequest),this.sizeListener&&window.removeEventListener("resize",this.sizeListener),this.containerScrollListener&&this.tableContainerParent.removeEventListener("click",this.containerScrollListener),this.clickListener&&this.cloneContainer.removeEventListener("click",this.clickListener),this.cloneHeader&&this.cloneContainer.removeChild(this.cloneHeader)}getScrollParent(e){let t=e.parentNode;if(!t)return document.scrollingElement||document.body;let n=t instanceof HTMLElement&&window.getComputedStyle(t).overflowY||"";return!(n.includes("hidden")||n.includes("visible"))&&t.scrollHeight>t.clientHeight?t:this.getScrollParent(t)}getAllScrollParents(){let e=[this.getScrollParent(this.tableContainer)];for(;e[e.length-1]!==document.scrollingElement&&e[e.length-1]!==document.body;)e.push(this.getScrollParent(e[e.length-1]));return e}setupClickEventMirroring(){this.clickListener=e=>{let t,n=this.cloneHeader.getBoundingClientRect(),i=e.clientX-n.x,r=e.clientY-n.y,l=this.getAllScrollParents();l.forEach(e=>e._save_scroll="scrollY"in e?e.scrollY:e.scrollTop),this.header.style.scrollMarginTop=`${this.getTop()+3}px`,this.header.scrollIntoView({behavior:"instant",block:"start"});let o=this.header.getBoundingClientRect(),s=[];do(t=document.elementFromPoint(o.x+i,o.y+r))&&!this.header.contains(t)&&(t.style.visibility="collapse",s.push(t));while(t&&!this.header.contains(t)&&s.length<10);t&&t.click&&t.click(),s.forEach(e=>e.style.removeProperty("visibility")),l.forEach(e=>e.scrollTo({behavior:"instant",top:e._save_scroll}))},this.cloneContainer.addEventListener("click",this.clickListener)}setupSticky(){this.cloneContainerParent.parentNode&&(this.cloneContainerParent.parentNode.style.position="relative");let e=()=>{this.currentFrameRequest=window.requestAnimationFrame(()=>{let e=this.tableContainer.getBoundingClientRect(),t=this.tableContainer.offsetTop,n=e.y,i=this.getBottom(),r=-n,l=this.getTop();r>-l&&null===this.cloneHeader&&(this.cloneContainerParent.style.display="none",this.cloneHeader=this.createClone()),null!==this.cloneHeader&&(r<=-l?(this.cloneContainerParent.style.display="none",this.cloneContainer.removeChild(this.cloneHeader),this.cloneHeader=null):-i<-l?(this.cloneContainerParent.style.display="block",this.cloneContainerParent.style.position="fixed",this.cloneContainerParent.style.top=`${l}px`,this.setHorizontalScrollOnClone()):(this.cloneContainerParent.style.display="block",this.cloneContainerParent.style.position="absolute",this.cloneContainerParent.style.top=`${i-n+t}px`))})};this.scrollListener=()=>e(),e(),window.addEventListener("scroll",this.scrollListener),this.scrollParents.forEach(e=>{e.addEventListener("scroll",this.scrollListener)})}setupSizeMirroring(){this.sizeListener=()=>{window.requestAnimationFrame(()=>{let e=this.header.getBoundingClientRect().width;this.cloneContainer.style.width=`${e}px`,this.cloneContainerParent.style.top=`${this.getTop()}px`,this.setHorizontalScrollOnClone()})},window.addEventListener("resize",this.sizeListener)}setupHorizontalScrollMirroring(){this.containerScrollListener=()=>{window.requestAnimationFrame(()=>{this.setHorizontalScrollOnClone()})},this.tableContainerParent.addEventListener("scroll",this.containerScrollListener)}createClone(){let e=this.header.cloneNode(!0);this.cloneContainer.append(e);let t=this.header.getBoundingClientRect().width;return Array.from(this.header.children).forEach((n,i)=>{Array.from(n.children).forEach((n,r)=>{e.children[i].children[r].style.width=n.getBoundingClientRect().width/t*100+"%"})}),this.cloneContainer.style.display="table",this.cloneContainer.style.width=`${t}px`,this.cloneContainerParent.style.position="fixed",this.cloneContainerParent.style.overflow="hidden",this.cloneContainerParent.style.top=`${this.getTop()}px`,this.setHorizontalScrollOnClone(),e}setHorizontalScrollOnClone(){this.cloneContainerParent.style.width=`${this.tableContainerParent.getBoundingClientRect().width}px`,this.cloneContainerParent.scrollLeft=this.tableContainerParent.scrollLeft}sizeToPx(e){if("number"==typeof e)return e;if(!e.match(/rem$/))return console.error("Unsupported size format for sticky table header displacement."),0;{let t=+e.replace(/rem$/,"");return Number.parseFloat(window.getComputedStyle(document.getElementsByTagName("html")[0]).fontSize)*t}}getTop(){let e=document.body.getBoundingClientRect().width,t=Object.entries(this.top).filter(([e])=>"max"!==e).sort(([e],[t])=>Number.parseInt(e,10)-Number.parseInt(t,10));for(let n=0,i;i=t[n++];)if(e<Number.parseInt(i[0],10))return this.sizeToPx(i[1]);return Math.max(this.sizeToPx(this.top.max),...this.scrollParents.map(e=>e.getBoundingClientRect().top))}getBottom(){let e=this.tableContainer.getBoundingClientRect(),t=this.getLastElement(),n=this.header.getBoundingClientRect().height;return Math.min((t?t.getBoundingClientRect().y:e.y+e.height)-n,...this.scrollParents.map(e=>e.getBoundingClientRect().bottom-2*n),Number.MAX_VALUE)}getLastElement(){return this.lastElement?(this.lastElementRefresh&&clearTimeout(this.lastElementRefresh),this.lastElementRefresh=setTimeout(()=>this.lastElement,2e3)):this.lastElement=this.tableContainer.querySelector(":scope > tbody:last-of-type > tr:last-child"),this.lastElement}}let o="development"===process.env.NODE_ENV,s="production"===process.env.NODE_ENV,a="undefined"==typeof window,h=e=>13===e.toString().length&&e>0&&e<41024448e5;export{r as $,l as StickyTableHeader,h as isMillisecondTimestamp,o as is_dev,s as is_prod,a as is_server};