import*as e from"await-to-js";import*as r from"deepmerge-ts";import*as a from"lodash-es";let t=(0,r.deepmergeCustom)({mergeArrays:(e,r)=>(0,a.uniq)(r.defaultMergeFunctions.mergeArrays(e))}),s=r=>({async query(a){let{config:s,sort_params:o,filter_relation:m,filter_params:l,page:i,pagesize:u}=a,d=s.cube_options||{},p=o.map(e=>[e.field,e.order],[]),f=[{[m]:l.map(e=>{let r={};return r.member=e.field,r.operator=e.expression,r.values=Array.isArray(e.value)?e.value:[e.value],r})}],[n,g]=await (0,e.default)(r.load(t({order:p,filters:f,offset:(i-1)*u,limit:u,total:!0},d)));return n?{error:n,message:n?.message}:{data:{items:g.rawData(),total:g.totalRows()}}}});export{s as default};