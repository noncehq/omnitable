let e=new WeakMap;function t(t,r,n){let i={ctx:this,fn:n},l=e.get(t);l||e.set(t,l=new Map);let o=l.get(r);o?o.push(i):l.set(r,[i])}function r(e,r,i){let l=this,o=(t,u)=>{n(e,r,o),i.call(l,t,u)};o.fn=i,t(e,r,o)}function n(t,r,n){if(void 0===r)return void e.set(t,new Map);let i=e.get(t);if(i){let e=i.get(r);if(e&&e.length>0){let t=[];n&&(t=e.filter(e=>e.fn!==n&&e.fn?.fn!==n)),i.set(r,t)}}}function i(t,r,...n){let l=e.get(t);if(l){let e=l.get(r);if(e){let[t,r]=n;e.forEach(e=>e.fn.call(e.ctx,t,r))}}}let l=Array.isArray,o=e=>"[object Date]"===c(e),u=e=>"string"==typeof e,a=e=>null!==e&&"object"==typeof e,f=e=>"string"==typeof e&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,c=e=>Object.prototype.toString.call(e),s=e=>c(e).slice(8,-1),g=(e,t)=>!Object.is(e,t);function p(e){try{return JSON.parse(e)}catch(t){return e}}let d=Object.prototype.hasOwnProperty,y=(e,t)=>d.call(e,t);function w(e){return(0,eval)(e)}let h="";function x(e){h=`${e}:`}let $=new WeakMap,v={storage:{},key:"",proxy:{}},S=!0;function k(e,t){return function(){delete e[t]}}function E(e,t,...r){let n=`${v.key}.${t}`;l(e)&&f(t)&&(n=`${v.key}[${t}]`),i(v.storage,n,...r)}let b=!1,m=function(){let e={};return["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...e){b=!0;let r=this.length,n=$.get(this)[t].apply(this,e);return this.length>r&&E(this,"length",this.length,r),b=!1,n}}),e}();function O(e,t,r){return l(e)&&y(m,t)?Reflect.get(m,t,r):Reflect.get(e,t,r)}function D(e){S=!1;let t=v.proxy.getExpires(v.key);v.proxy[v.key]=e,t&&v.proxy.setExpires(v.key,t),S=!0}function N(e,t,r,n){let i;l(e)&&!b&&(i=e.length);let o=e[t],u=l(e)&&f(t)?Number(t)<e.length:y(e,t),a=Reflect.set(e,t,r,n);return a&&g(r,o)&&(u?E(e,t,r,o):E(e,t,r,void 0),l(e)&&void 0!==i&&Number(t)>=i&&E(e,"length",e.length,i),D(e)),a}function P(e,t){let r=y(e,t),n=e[t],i=Reflect.deleteProperty(e,t);return i&&r&&(E(e,t,void 0,n),D(e)),i}function j(e){let t=new Proxy(e,{get:O,set:N,deleteProperty:P});return $.set(t,e),t}let R={String:{read:e=>e,write:e=>e},Number:{read:e=>Number.parseFloat(e),write:e=>String(e)},BigInt:{read:e=>BigInt(e),write:e=>String(e)},Boolean:{read:e=>"true"===e,write:e=>String(e)},Null:{read:()=>null,write:e=>String(e)},Undefined:{read:()=>void 0,write:e=>String(e)},Object:{read:e=>j(e),write:e=>e},Array:{read:e=>j(e),write:e=>e},Set:{read:e=>new Set(e),write:e=>Array.from(e)},Map:{read:e=>new Map(e),write:e=>Array.from(e)},Date:{read:e=>new Date(e),write:e=>String(e)},RegExp:{read:e=>(0,eval)(e),write:e=>String(e)},Function:{read:e=>(0,eval)(`(function() { return ${e} })()`),write:e=>String(e)}};function M(e,t){if(!e)return;let r=e;try{r=p(e)}catch(e){}if(!a(r))return r;if(r.expires&&new Date(+r.expires).getTime()<=Date.now())return void t?.();let n=R[r.type];return n?n.read(r.value):r.value}function I(e,t){let r=s(e),n=R[r];if(!n)throw Error(`can't set "${r}" property.`);let i={type:r,value:n.write(e)};return t&&(i.expires=t),JSON.stringify(i)}function V(e,t,r,n){let i;if((i=o(r)?r.getTime():u(r)?+r.padEnd(13,"0"):r)<=Date.now())return void delete n[t];let l=n[t];if(l)return l=$.get(l)||l,e[`${h}${t}`]=I(l,""+i),new Date(i)}function A(e,t){let r=`${h}${t}`;if(!e[r])return;let n=p(e[r]);if(!(!a(n)||!n.expires||+n.expires<=Date.now()))return new Date(+n.expires)}function B(e,t,r){let n=r[t];n&&(n=$.get(n)||n,e[`${h}${t}`]=I(n))}let W=new Map;function F(e,i,l){S&&(v.storage=e,v.key=i,v.proxy=l);let o=W.get(e);if(o||(o=function(e,i){let l={};["clear","key"].forEach(t=>{l[t]=e[t].bind(e)});let o={getItem:F,setItem:J,setExpires:V,removeExpires:B};Object.keys(o).forEach(t=>{l[t]=function(...r){return o[t](e,...r,i)}});let u={removeItem:L,getExpires:A,off:n,on:t,once:r};return Object.keys(u).forEach(t=>{l[t]=function(...r){return u[t](e,...r)}}),l}(e,l),W.set(e,o)),y(o,i))return Reflect.get(o,i,l);if(!T(e,i))return;let u=`${h}${i}`,a=e[u]||e[i];return a?M(a,k(e,u)):a}function J(e,t,r,n){let l=`${h}${t}`,o=M(e[l],k(e,l));o=$.get(o)||o;let u=Reflect.set(e,l,I(r),n);return u&&g(r,o)&&S&&i(e,t,r,o),u}function T(e,t){return e.hasOwnProperty(`${h}${t}`)||!e.hasOwnProperty(t)&&t in e}function L(e,t){let r=`${h}${t}`,n=y(e,r),l=M(e[r],k(e,r));l=$.get(l)||l;let o=Reflect.deleteProperty(e,r);return o&&n&&i(e,t,void 0,l),o}function U(e){return e?new Proxy(e,{get:F,set:J,has:T,deleteProperty:L}):null}let q="undefined"!=typeof localStorage?localStorage:void 0,z="undefined"!=typeof sessionStorage?sessionStorage:void 0;"undefined"!=typeof window&&window.addEventListener("storage",e=>{if(e.key&&e.key.startsWith(h)){let t=e.newValue,r=e.oldValue;e.newValue&&a(t=M(e.newValue,k(q,e.key)))&&(t=$.get(t)||t),e.oldValue&&a(r=M(e.oldValue,k(q,e.key)))&&(r=$.get(r)||r),i(q,e.key.slice(h.length),t,r)}});let C=U(q),G=U(z);export{M as decode,I as encode,C as local,G as session,x as setPrefix};